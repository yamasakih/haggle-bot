# haggle_bot

## インストール
このリポジトリをクローンまたはzipファイルでダウンロードして解凍してください。

```
git clone https://github.com/yamasakih/haggle_bot.git
```

## 必要なもの
・Python (version 3.4以上)
### Pythonのモジュール
・slacker
・slackbot
どちらもPythonをインストールした後にpip installでインストールできます。
### Slackのアカウント、チーム
ハグルをするためのSlackのアカウントやチームを作成してください。
Slack使い方は十分に理解しているものとして話をすすめていきます。

### Slack Botアカウント
Slack Botアカウントの作り方は例えば[このようなサイト](http://blog.bitmeister.jp/?p=389)を参考にしてください。
（上のサイトの場合、「Slack Botアカウントの作成」という項目までを行ってもらえれば結構です)

## 設定
haggle_bot/haggle/slackbot_settings.pyを開き
API_TOKENの値を自分で作成したSlack BotのAPI_TOKENに書き換えてください。

## ボットの起動方法
hagge_bot/haggle/run.pyを実行するとボットが起動します。

```
python haggle_bot/haggle/run.py
```

## 使用方法
ボットを招待したチャンネルやダイレクトメッセージではボットに対してコマンドを入力するとボットがそれに対するリプライをします。
これ以降の説明はそのようなチャンネルでコマンドをしていると考えてください。
コマンドは必ず先頭にBotに対するメンションあるいは. を使います(.がメンションのエイリアスになっています)

例、Botの名前がhaggle_botだとしたら
```
@haggle_bot hand
```
あるいは
```
. hand
```

以後の説明では. を使ったコマンドで説明していきます。

### 1.ゲームのルールや初期手札の用意
haggle_bot/haggle/game_settingsにゲームのデータをあらかじめ入れておきます。
ゲームのデータは必ずutf-8でコーディングして保存してください。
以後、tutorial_cardと書いたゲームのデータを用意したとして続きを説明します。

### 2.ゲームの読み込み
makeコマンドでtutorial_cardを読み込めます。

```
. make tutorial_card
```

ゲームが正しく読み込めたら
ゲームtutorial_cardをする準備ができました！と表示されます。
なお誤作動で再び読み込むことがないように、
一度ゲームの読み込みをすると別のゲームの読み込みができないようになっています。
別のゲームをもう一度読み込みたい時はCrtl+Cなどでpython haggle_bot/haggle/run.pyの実行を一度切り
再度ボットを起動してください。

### 3.ゲーム中にできるコマンド
ゲームのデータの３行目以降にかかれているアカウントのゲームプレーヤーは以下のコマンドを実行することができます。

#### 現在持っているルールを表示する。
```
. rule
```

#### 現在持っている手札(トランプあるいはハート)を表示する。
```
. hand
```

現在の仕様ではSlackの絵文字に色が複数ある絵文字がハートの絵文字しかないので
色の付いたコインのかわりにハートを代用してます。
そのハートあるいはトランプを用いたゲームができるようになっており
それはゲームのデータのToken=CardあるいはToken=Coinとすることでトランプかハートを選ぶことができます。


#### 現在持っている特定のルールのみを表示する。
例えばルール5を表示したい場合
```
. rule 5
```

#### 現在持っている特定の手札のみを表示する。
トランプとハートで少し変わってきます。
##### トランプの場合
例えばハートの5を表示したい場合
```
. hand h5
```
スペード、ハート、クラブ、ダイヤはそれぞれs,h,c,dと略して使います。
J,Q,K,Aは11,12,13,1でもOKです。

##### ハートの場合
例えば青色のハートを１つを表示したい場合
```
. hand b1
```
赤色、青色、緑色、黄色、紫色はそれぞれr,b,g,y,pと略して使います。

例えば赤色のハート２つと紫色のハート３つを表示したい場合
```
. hand r2,p3
```
現在の仕様ではハートのみ複数個同時に見せることができます。
(ルールとトランプもいつか複数同時に表示できるようにする予定です)


#### 現在持っているルールを他のプレーヤーにわたす。
ルールも手札も他のプレーヤーにわたすときには、
表示するコマンドの後ろにわたす相手をつければわたせます。

例えばルール10をプレーヤーyamにわたしたい場合
```
. rule 10 yam
```
メンションをつけると(@yamとすると)わたせないので注意してください。
(メンションをつけたほうが便利だと思うのでそのうちメンションをつけてもわたせるようにする予定です)


#### 現在持っている手札を他のプレーヤーにわたす。
##### トランプの場合
例えばダイヤの9をプレーヤーyamにわたしたい場合
```
. hand d9 yam
```

##### ハートの場合
例えば緑色のハート１つと黄色のハート２つをプレーヤーyamにわたしたい場合
```
. hand g1,y2 yam
```
